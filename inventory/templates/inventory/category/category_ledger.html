{% extends "base.html" %} {% load static %} {% block content %}
<div class="row mb-3">
  <div class="col-lg-12">
    <div class="stat-card">
      <div class="container py-4">
        <!-- HERO -->
        <div class="d-flex align-items-center justify-content-between mb-4">
          <div>
            <h1 class="h3 mb-1">
              <i class="bi bi-shop-window-fill text-primary"></i>
              {% if parent.is_active %}
              <span
                class="badge bg-success-subtle text-success border border-success-subtle px-3 py-2 fs-8"
              >
                <b></b>
                {{ parent.category_name }}
                <small>({{ sub_categories.count }})</small>
              </span>
              {% else %}
              <span
                class="badge bg-danger-subtle text-danger border border-danger-subtle px-3 py-2 fs-8"
              >
                <b></b>{{ parent.category_name }}
                <small>({{ sub_categories.count }})</small>
              </span>
              {% endif %}
            </h1>
            <div class="text-muted small">
              Category • Sub-categories & products
            </div>
          </div>
          <div class="d-flex gap-2">
            <a
              href='{% url "category_list" %}'
              class="btn btn-sm btn-outline-secondary"
              ><i class="bi bi-arrow-left"></i> Back</a
            >
          </div>
        </div>

        <div class="row g-4">
          <!-- LEFT: Subcategories (list-group) -->
          <!-- LEFT -->
          <aside class="col-12 col-md-4 col-lg-3">
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="list-group" id="list-tab" role="tablist">
                  {% for sub in sub_categories %}
                  <a
                    class="list-group-item list-group-item-action d-flex justify-content-between align-items-center {% if forloop.first %}active{% endif %}"
                    id="list-{{sub.id}}-list"
                    data-bs-toggle="list"
                    href="#list-{{sub.id}}"
                    role="tab"
                    aria-controls="list-{{sub.id}}"
                  >
                    {{sub.category_name}}
                    <span class="badge bg-light text-dark"
                      >{{ sub.products.count }}</span
                    >
                  </a>
                  {% endfor %}
                </div>
              </div>
            </div>
          </aside>

          <!-- RIGHT -->
          <main class="col-12 col-md-8 col-lg-9">
            <div class="tab-content" id="nav-tabContent">
              {% for sub in sub_categories %}
              <div
                class="tab-pane fade {% if forloop.first %}show active{% endif %}"
                id="list-{{sub.id}}"
                role="tabpanel"
                aria-labelledby="list-{{sub.id}}-list"
              >
                {% if sub.products.all %}
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
                  {% for product in sub.products.all %}
                  <!-- Product 2 -->
                  <div class="col">
                    <div class="card h-100 shadow-sm">
                      {% if product.image %}
                      <img
                        src="{{ product.image.url }}"
                        class="card-img-top"
                        alt="{{ product.product_name }}"
                      />
                      {% else %}
                      <img
                        src="https://via.placeholder.com/500x320?text=Blue+Cotton+Shirt"
                        class="card-img-top"
                        alt="{{ product.product_name }}"
                      />
                      {% endif %}
                      <div class="card-body">
                        <div
                          class="d-flex justify-content-between align-items-start mb-1"
                        >
                          <h6 class="mb-0">{{ product.product_name }}</h6>

                          {% if product.is_active %}
                          <span class="badge bg-success">Active</span>

                          {% else %}
                          <span class="badge bg-danger">Inactive</span>

                          {% endif %} {% if product.stock > 0 %}
                        </div>
                        <span class="badge bg-success">In stock</span>
                        {% else %}
                        <span class="badge bg-danger">Out of stock</span>
                        {% endif %}

                        <div
                          class="d-flex justify-content-between align-items-center mb-2"
                        >
                          <div class="fw-semibold">
                            ₨ {{ product.selling_price }}
                          </div>
                          <div class="small text-muted">
                            SKU: S-00{{ product.id }}
                          </div>
                        </div>

                        <div class="mb-2 small text-muted">
                          Measure: {{ product.measure }}
                        </div>
                        <div class="mb-2 small text-muted">
                          Warehouse: {{ product.warehouse.warehouse_name }}
                        </div>
                        <div class="mb-2 small text-muted">
                          Last updated on
                          <b></b>{{ product.updated_at | date:"d M Y" }}
                        </div>
                        <div class="mb-2 small text-muted">Stock</div>
                        <div
                          class="progress mb-2"
                          role="progressbar"
                          aria-label="Stock"
                          aria-valuenow="{{ product.stock }}"
                          aria-valuemin="0"
                          aria-valuemax="100"
                        >
                          <div
                            class="progress-bar bg-success"
                            style="width: 90%"
                          ></div>
                        </div>
                        <div class="d-flex gap-2">
                          <a
                            class="btn btn-sm btn-outline-primary w-100"
                            href='{% url "view_product" product.id %}'
                            ><i class="bi bi-eye"></i> View</a
                          >
                          <a
                            class="btn btn-sm btn-primary w-100"
                            href='{% url "edit_product" product.id %}'
                            ><i class="bi bi-pencil"></i> Edit</a
                          >
                        </div>
                      </div>
                    </div>
                  </div>

                  {% endfor %}
                </div>
                {% else %}
                <div class="text-center text-muted py-5">No products found</div>
                {% endif %}
              </div>
              {% endfor %}
            </div>
          </main>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
